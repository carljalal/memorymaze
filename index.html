<html>
<body>
<script>


//wordDict = ["dictionary","for","foreach","if","currentPosition","randomItem",".push","[i]",".style."];
wordDict = [];
checkPlaces = [];
lastCheckPlace = {};
currentTargetPlaceIndex = 0;
mapBoundX = 10;
mapBoundY = 10;





basicRandom = (min,max) => {
    return Math.floor(Math.random() * (max-min+1)) + min;
}

randomItem = (dict) => {
    return dict[basicRandom(0,dict.length - 1)];
}

randomItemDifferent = (dict,unmatch) => {
    for(let i = 0; i < 1000; i++){
        let randomWord = dict[basicRandom(0,dict.length - 1)];
        if (randomWord != unmatch) return randomWord;
    }
    return randomWord;
    feedbackElement.innerHTML = "we're on duplicates now";
}






addCheckPlace = () => {
    let randx = basicRandom(0,mapBoundX-1);
    let randy = basicRandom(0,mapBoundY-1);
    randWord = "";
    // make sure it's unique
    let found = false;
    for(let i = 0; i <= 1000; i++){
        randWord = randomItem(wordDict);
        found = false;
        for(let j = 0; j < checkPlaces.length; j++){
            if(checkPlaces[j].word == randWord) {
                found = true;
                break;
            }
        }
        if(found == false) break;
    }
    // if it's a repeat after 1000 times, still add one
    lastCheckPlace = {x:randx,y:randy,word:randWord};
    checkPlaces.push(lastCheckPlace);
    
}



mapElement = document.createElement("div");
mapElement.style.fontFamily = "Andale Mono"
mapElement.style.fontSize = "40px"
mapElement.style.whiteSpace = "pre-line";
document.body.append(mapElement);




leftElement = document.createElement("button");
rightElement = document.createElement("button");
pickupElement = document.createElement("button");
upElement = document.createElement("button");
downElement = document.createElement("button")
putdownElement = document.createElement("button")
initElement = document.createElement("button")
questionElement = document.createElement("div")
answerElement = document.createElement("textarea")
historyElement = document.createElement("div")
hintElement = document.createElement("div")
feedbackElement = document.createElement("div")
checkElement = document.createElement("button");

pickupElement.innerHTML = "pick up"
upElement.innerHTML = "go up!"
downElement.innerHTML = "go down!"
putdownElement.innerHTML = "put down"
initElement.innerHTML = "start"
questionElement.innerHTML = "";
historyElement.innerHTML = "";
hintElement.innerHTML = "";


document.body.append(checkElement);
document.body.append(upElement)
document.body.append(downElement)
document.body.append(leftElement);
document.body.append(rightElement);
document.body.append(pickupElement)
document.body.append(putdownElement)
document.body.append(initElement)

document.body.append(questionElement)
document.body.append(hintElement)
document.body.append(historyElement)
document.body.append(answerElement)
document.body.append(feedbackElement)


leftElement.innerHTML = "go left!";
rightElement.innerHTML = "go right!";

insideElement = document.createElement("div");
document.body.append(insideElement);


checkElement.innerHTML = "check!";

answerElement.value = "write list here (each word on new line)"
answerElement.cols = 50
answerElement.rows = 10

hideShowNonInitButtons = (state) => {
    checkElement.style.display = state
    upElement.style.display = state
    downElement.style.display = state
    leftElement.style.display = state
    rightElement.style.display = state
    pickupElement.style.display = state
    putdownElement.style.display = state
}

hideShowNonInitButtons("none");

mapVar = []
displayMapVar = []

for(let i = 0; i < 100; i++){
    mapVar.push([]);
    for(let j = 0; j < 100; j++){
        mapVar[i].push("X");
    }
}



for(let i = 0; i < 5; i++){
    displayMapVar.push([]);
    for(let j = 0; j < 5; j++){
        displayMapVar[i].push("");
    }
}


currentPosition = {x: 0, y: 0};


isInsideCheckPlaces = (word) => {
    for(let i = 0; i < checkPlaces.length; i++){
        if(checkPlaces[i].word == word) return true;
    }
    return false;
}



checkElement.onclick = () => {
    correct = false;
    if(isInsideCheckPlaces(answerElement.value)){
        if(currentPosition.x == checkPlaces[currentTargetPlaceIndex].x 
        && currentPosition.y == checkPlaces[currentTargetPlaceIndex].y){
            if(basicRandom(0,3)==0) addCheckPlace();
            newQuestion();
            correct = true;
        }
    }
    answerElement.value = ""
    if(correct==false) {
        feedbackElement.innerHTML = "error"
    }
    else {
        feedbackElement.innerHTML = "you got it!"
    }
}





displayMap = () => {
    feedbackElement.innerHTML = ""
    insideElement.innerHTML = "words inside:<br>";
    for(let checkPlaceIdx = 0; checkPlaceIdx < checkPlaces.length; checkPlaceIdx++){
        if(currentPosition.x == checkPlaces[checkPlaceIdx].x && currentPosition.y == checkPlaces[checkPlaceIdx].y){
            insideElement.innerHTML += checkPlaces[checkPlaceIdx].word + "<br>";
        }
    }

    // write the O for all positions which is a check place
    for(let i = 0; i < checkPlaces.length; i++){
        let xx = checkPlaces[i].x;
        let yy = checkPlaces[i].y;
        mapVar[xx][yy] = "O";
    }

    for(let xx = currentPosition.x - 2; xx <= currentPosition.x + 2; xx++){
        for(let yy = currentPosition.y - 2; yy <= currentPosition.y + 2; yy++){
            if(xx < 0 || yy < 0) displayMapVar[xx - currentPosition.x + 2][yy - currentPosition.y + 2] = "8";
            else if(xx >= mapBoundX || yy >= mapBoundY) displayMapVar[xx - currentPosition.x + 2][yy - currentPosition.y + 2] = "8";
            else displayMapVar[xx - currentPosition.x + 2][yy - currentPosition.y + 2] = mapVar[xx][yy];
        }
    }
    mapElement.innerHTML = "";
    let tempText = "";
    for(let yy = 0; yy < 5; yy++){
        for(let xx = 0; xx < 5; xx++){
            if(xx == 2 && yy == 2) {
                tempText+= "<span style=\"font-weight:bold;color:aqua\">";
            }
            tempText += displayMapVar[xx][yy];
            tempText += " ";
            if(xx == 2 && yy == 2) {
                tempText+= "</span>"
            }
        }
        if (yy < 4) tempText+= "<br>";
    }
    mapElement.innerHTML = tempText;
}


leftElement.onclick = () => {
    if(currentPosition.x > 0) currentPosition.x--;
    displayMap();
}
rightElement.onclick = () => {
    if(currentPosition.x < mapBoundX-1) currentPosition.x++;
    displayMap();

}
upElement.onclick = () => {
    if(currentPosition.y > 0) currentPosition.y--;
    displayMap();
}
downElement.onclick = () => {
    if(currentPosition.y < mapBoundY-1) currentPosition.y++;
    displayMap();
}

newQuestion = () => {
    currentTargetPlaceIndex = basicRandom(0,checkPlaces.length-1)
    questionElement.innerHTML = "go to " + checkPlaces[currentTargetPlaceIndex].word;
}

removeItemAll = (arr, value) => {
  var i = 0;
  while (i < arr.length) {
    if (arr[i] === value) {
      arr.splice(i, 1);
    } else {
      ++i;
    }
  }
  return arr;
}

initElement.onclick = () => {
    hideShowNonInitButtons("");
    initElement.style.display = "none"

    wordListString = answerElement.value
    wordListString = wordListString.replace("\r\g","");
    wordListArray = wordListString.split("\n");
    wordListArray = removeItemAll(wordListArray,"");
    wordDict = wordListArray;
    
    answerElement.value = "";
    answerElement.cols = 50
    answerElement.rows = 1

    mapElement.style.border = "3px orange"

    
    checkPlaces = [];
    lastCheckPlace = {};

    mapVar = []
    displayMapVar = []

    for(let i = 0; i < mapBoundX; i++){
        mapVar.push([]);
        for(let j = 0; j < mapBoundY; j++){
            mapVar[i].push("X");
        }
    }



    for(let i = 0; i < 5; i++){
        displayMapVar.push([]);
        for(let j = 0; j < 5; j++){ 
            displayMapVar[i].push("");
        }
    }


    currentPosition = {x: 0, y: 0};
    for(let i = 1; i <= 3; i++) addCheckPlace();
    newQuestion();
    displayMap();
    
}




</script>
</body>
</html>